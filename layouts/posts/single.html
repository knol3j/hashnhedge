{{ define "main" }}
{{- /* AMP Version Link */ -}}
{{ if not hugo.IsServer }}
<link rel="amphtml" href="{{ .Permalink }}amp/">
{{ end }}
<article class="post-single">
  <header class="post-header">
    <h1 class="post-title">{{ .Title }}</h1>
    <div class="post-meta">
      <time datetime="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}">{{ .Date.Format "January 2, 2006" }}</time>
      {{ with .Params.categories }}
      <span class="post-categories">
        {{ range . }}
        <a href="{{ "categories/" | absURL }}{{ . | urlize }}">{{ . }}</a>
        {{ end }}
      </span>
      {{ end }}
    </div>
  </header>

  {{ with .Params.featured_image }}
  <div class="post-featured-image">
    <img src="{{ . }}" alt="{{ $.Title }}" />
  </div>
  {{ end }}

  <div class="post-content">
    {{- $content := .Content -}}
    {{- $paragraphs := split $content "</p>" -}}
    {{- $totalParagraphs := len $paragraphs -}}
    
    {{- if gt $totalParagraphs 4 -}}
      {{- /* For articles with more than 4 paragraphs, insert ads */ -}}
      
      {{- /* First part of content (first 2 paragraphs) */ -}}
      {{- range $i, $p := $paragraphs -}}
        {{- if lt $i 2 -}}
          {{ $p }}</p>
        {{- end -}}
      {{- end -}}
      
      {{- /* First ad after 2nd paragraph */ -}}
      {{ partial "adsense-in-article.html" . }}
      
      {{- /* Middle part of content */ -}}
      {{- $middleStart := 2 -}}
      {{- $middleEnd := div $totalParagraphs 2 -}}
      {{- range $i, $p := $paragraphs -}}
        {{- if and (ge $i $middleStart) (lt $i $middleEnd) -}}
          {{ $p }}</p>
        {{- end -}}
      {{- end -}}
      
      {{- /* Second ad in the middle if article is long enough */ -}}
      {{- if gt $totalParagraphs 8 -}}
        {{ partial "adsense-in-article.html" . }}
      {{- end -}}
      
      {{- /* Rest of the content */ -}}
      {{- range $i, $p := $paragraphs -}}
        {{- if ge $i $middleEnd -}}
          {{- if $p -}}
            {{ $p }}</p>
          {{- end -}}
        {{- end -}}
      {{- end -}}
      
    {{- else -}}
      {{- /* For shorter articles, just show content without ads */ -}}
      {{ .Content }}
    {{- end -}}
  </div>

  {{- /* Ad at the end of article */ -}}
  <div class="post-footer-ad">
    {{ partial "adsense-in-article.html" . }}
  </div>

  <footer class="post-footer">
    {{ with .Params.tags }}
    <div class="post-tags">
      {{ range . }}
      <a href="{{ "tags/" | absURL }}{{ . | urlize }}">#{{ . }}</a>
      {{ end }}
    </div>
    {{ end }}
    
    <div class="post-nav">
      {{ with .PrevInSection }}
      <a href="{{ .Permalink }}" class="prev-post">← {{ .Title }}</a>
      {{ end }}
      {{ with .NextInSection }}
      <a href="{{ .Permalink }}" class="next-post">{{ .Title }} →</a>
      {{ end }}
    </div>
  </footer>
</article>
{{ end }}
