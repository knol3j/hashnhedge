{{ define "main" }}
<article class="amp-article">
    <header>
        <h1>{{ .Title }}</h1>
        <time datetime="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}">
            {{ .Date.Format "January 2, 2006" }}
        </time>
    </header>

    {{- /* First AMP Ad - After header */ -}}
    <div class="amp-ad-container">
        <amp-ad width="100vw" height="320"
            type="adsense"
            data-ad-client="ca-pub-4626165154390205"
            data-ad-slot="9676890798"
            data-auto-format="rspv"
            data-full-width="">
            <div overflow=""></div>
        </amp-ad>
    </div>

    <div class="content">
        {{- $content := .Content -}}
        {{- $paragraphs := split $content "</p>" -}}
        {{- $totalParagraphs := len $paragraphs -}}
        
        {{- if gt $totalParagraphs 4 -}}
            {{- /* First 3 paragraphs */ -}}
            {{- range $i, $p := $paragraphs -}}
                {{- if lt $i 3 -}}
                    {{ $p | safeHTML }}</p>
                {{- end -}}
            {{- end -}}
            
            {{- /* Mid-article AMP Ad */ -}}
            <div class="amp-ad-container in-article">
                <amp-ad width="100vw" height="320"
                    type="adsense"
                    data-ad-client="ca-pub-4626165154390205"
                    data-ad-slot="9676890798"
                    data-auto-format="rspv"
                    data-full-width="">
                    <div overflow=""></div>
                </amp-ad>
            </div>
            
            {{- /* Middle paragraphs */ -}}
            {{- $middleEnd := div $totalParagraphs 2 -}}
            {{- range $i, $p := $paragraphs -}}
                {{- if and (ge $i 3) (lt $i $middleEnd) -}}
                    {{ $p | safeHTML }}</p>
                {{- end -}}
            {{- end -}}
            
            {{- /* Another ad for long articles */ -}}
            {{- if gt $totalParagraphs 10 -}}
            <div class="amp-ad-container in-article">
                <amp-ad width="100vw" height="320"
                    type="adsense"
                    data-ad-client="ca-pub-4626165154390205"
                    data-ad-slot="9676890798"
                    data-auto-format="rspv"
                    data-full-width="">
                    <div overflow=""></div>
                </amp-ad>
            </div>
            {{- end -}}
            
            {{- /* Remaining paragraphs */ -}}
            {{- range $i, $p := $paragraphs -}}
                {{- if ge $i $middleEnd -}}
                    {{- if $p -}}
                        {{ $p | safeHTML }}</p>
                    {{- end -}}
                {{- end -}}
            {{- end -}}
            
        {{- else -}}
            {{- /* Short articles - just show content */ -}}
            {{ .Content | safeHTML }}
        {{- end -}}
    </div>

    {{- /* End of article AMP Ad */ -}}
    <div class="amp-ad-container footer-ad">
        <amp-ad width="100vw" height="320"
            type="adsense"
            data-ad-client="ca-pub-4626165154390205"
            data-ad-slot="9676890798"
            data-auto-format="rspv"
            data-full-width="">
            <div overflow=""></div>
        </amp-ad>
    </div>

    <footer>
        {{ with .Params.tags }}
        <div class="tags">
            {{ range . }}
            <a href="{{ "tags/" | absURL }}{{ . | urlize }}">#{{ . }}</a>
            {{ end }}
        </div>
        {{ end }}
        
        <nav class="post-nav">
            {{ with .PrevInSection }}
            <a href="{{ .Permalink }}amp/" rel="prev">← {{ .Title }}</a>
            {{ end }}
            {{ with .NextInSection }}
            <a href="{{ .Permalink }}amp/" rel="next">{{ .Title }} →</a>
            {{ end }}
        </nav>
    </footer>
</article>
{{ end }}
