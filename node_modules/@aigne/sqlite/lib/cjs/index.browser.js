"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.initDatabase = initDatabase;
const sqlite_proxy_1 = require("drizzle-orm/sqlite-proxy");
// @ts-ignore sqlocal does not support commonjs, but we can use it in the browser with ESM module
const drizzle_1 = require("sqlocal/drizzle");
const promise_js_1 = require("./promise.js");
async function initDatabase({ url = ":memory:", } = {}) {
    const init = (0, promise_js_1.promiseWithResolvers)();
    const { driver } = new drizzle_1.SQLocalDrizzle({
        databasePath: url,
        onConnect: () => init.resolve(),
    });
    await init.promise;
    const db = (0, sqlite_proxy_1.drizzle)(driver);
    return db;
}
