<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="/css/hnh.css">
<title>{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }} | {{ .Site.Title }}{{ end }}</title>
<link rel="alternate" type="application/rss+xml" href="{{ .Site.BaseURL }}index.xml" title="RSS" />
{{ with .Permalink }}<link rel="canonical" href="{{ . }}" />{{ end }}

{{/* SEO: description, Open Graph, Twitter */}}
{{ $desc := .Params.description }}
{{ if not $desc }}{{ $desc = cond .IsHome .Site.Params.tagline (.Summary | plainify | truncate 160) }}{{ end }}
<meta name="description" content="{{ $desc }}">
<meta property="og:title" content="{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }} | {{ .Site.Title }}{{ end }}">
<meta property="og:description" content="{{ $desc }}">
<meta property="og:type" content="{{ if .IsHome }}website{{ else }}article{{ end }}">
<meta property="og:url" content="{{ .Permalink }}">
{{ with .Params.image }}<meta property="og:image" content="{{ . | absURL }}">{{ end }}
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }} | {{ .Site.Title }}{{ end }}">
<meta name="twitter:description" content="{{ $desc }}">
{{ with .Params.image }}<meta name="twitter:image" content="{{ . | absURL }}">{{ end }}
<meta name="theme-color" content="#111111">

{{/* Resource hints for GA/Ads to reduce connection latency (safe with consent gating) */}}
<link rel="preconnect" href="https://www.googletagmanager.com" crossorigin>
<link rel="preconnect" href="https://pagead2.googlesyndication.com" crossorigin>
<link rel="dns-prefetch" href="//www.googletagmanager.com">
<link rel="dns-prefetch" href="//pagead2.googlesyndication.com">

{{/* JSON-LD: Organization and WebSite */}}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "{{ .Site.Title }}",
  "url": "{{ .Site.BaseURL }}",
  "logo": "{{ "/logo.svg" | absURL }}"
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "{{ .Site.Title }}",
  "url": "{{ .Site.BaseURL }}",
  "potentialAction": {
    "@type": "SearchAction",
    "target": "{{ .Site.BaseURL }}?s={search_term_string}",
    "query-input": "required name=search_term_string"
  }
}
</script>

{{/* AdSense site verification (optional but recommended) */}}
{{ with .Site.Params.adsense_publisher_id }}
  <meta name="google-adsense-account" content="{{ . }}">
{{ end }}

{{/* Google Consent Mode v2 defaults: deny in EEA/UK/CH, grant elsewhere */}}
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('consent', 'default', {
    'ad_storage': 'denied',
    'analytics_storage': 'denied',
    'functionality_storage': 'denied',
    'personalization_storage': 'denied',
    'security_storage': 'granted',
    'ad_user_data': 'denied',
    'ad_personalization': 'denied'
  });
  gtag('set', 'url_passthrough', true);
</script>
<script>
  // Region-specific default for EEA/UK/CH
  gtag('consent', 'default', {
    'region': ['AT','BE','BG','HR','CY','CZ','DK','EE','FI','FR','DE','GR','HU','IE','IT','LV','LT','LU','MT','NL','PL','PT','RO','SK','SI','ES','SE','IS','LI','NO','GB','CH'],
    'ad_storage': 'denied',
    'analytics_storage': 'denied',
    'functionality_storage': 'denied',
    'personalization_storage': 'denied',
    'security_storage': 'granted',
    'ad_user_data': 'denied',
    'ad_personalization': 'denied'
  });
</script>

{{/* Google Tag (GA4) */}}
{{ $ga4 := .Site.Params.ga4.id }}
{{ with $ga4 }}
  cscript async src="https://www.googletagmanager.com/gtag/js?id={{ . }}"ec/scripte
  cscripte
    gtag('js', new Date());
    gtag('config', '{{ . }}', { 'anonymize_ip': true });
  c/scripte
{{ end }}

{{/* Consent banner logic to gate AdSense loading lives in /js/consent.js */}}
<script src="/js/consent.js" defer></script>

{{/* Custom site CSS overrides (safe to keep with any theme) */}}
<link rel="stylesheet" href="/css/custom.css">

{{/* Optional: Google Funding Choices (CMP) snippet can be added via params.funding_choices_snippet */}}
{{ with .Site.Params.funding_choices_snippet }}
  {{ . | safeHTML }}
{{ end }}
