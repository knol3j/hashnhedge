{{ define "main" }}
  <h1 class="text-3xl font-semibold mb-6">{{ .Title }}</h1>
  {{ if .Content }}<div class="prose mb-8">{{ .Content }}</div>{{ end }}

  <div id="post-grid" class="grid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:24px;">
    {{ range .Paginator.Pages }}
    <article class="card" style="border:1px solid #e5e7eb;border-radius:12px;overflow:hidden;background:var(--card-bg,#fff);">
      {{ $img := .Params.image }}
      {{ if not $img }}
        {{ $cat := index .Params "category" | default (index .Params "categories") }}
        {{ $lookup := site.Params.category_defaults }}
        {{ if and (not $img) $cat $lookup }}
          {{ $key := (cond (reflect.IsSlice $cat) (lower (delimit $cat "-")) (lower $cat)) }}
          {{ $def := index $lookup $key }}
          {{ if $def }}{{ $img = $def }}{{ end }}
        {{ end }}
        {{ if not $img }}
          {{ $re := findRE "<img[^>]+src=\"([^\"]+)\"" .Content 1 }}
          {{ if gt (len $re) 0 }}
            {{ $match := index $re 0 }}
            {{ $src := replaceRE ".*src=\"([^\"]+)\".*" "$1" $match }}
            {{ $img = $src }}
          {{ else }}
            {{ $img = (index $lookup "default") }}
          {{ end }}
        {{ end }}
      {{ end }}
      {{ with $img }}
        <a href="{{ $.RelPermalink }}" aria-label="{{ $.Title }}">
          <img src="{{ . | absURL }}" alt="" loading="lazy" decoding="async" style="width:100%;height:180px;object-fit:cover;" />
        </a>
      {{ end }}
      <div class="card-body" style="padding:16px;">
        <h2 class="card-title" style="font-size:1.125rem;line-height:1.4;margin:0 0 6px 0;"><a href="{{ .RelPermalink }}">{{ .Title }}</a></h2>
        <div class="card-meta" style="color:var(--muted,#6b7280);font-size:0.875rem;margin-bottom:8px;">{{ .Date.Format "Jan 2, 2006" }}{{ with .Params.category }} â€¢ {{ . }}{{ end }}</div>
        {{ with .Summary }}<p class="card-summary" style="margin:0;color:var(--text,#374151);">{{ . }}</p>{{ end }}
      </div>
    </article>
    {{ end }}
  </div>

  <nav id="pager" style="display:none;">
    {{ with .Paginator.Next }}<a id="next-link" rel="next" href="{{ .URL }}"></a>{{ end }}
  </nav>
  <div style="text-align:center;margin-top:16px;">
    <button id="load-more" style="display:none;padding:10px 16px;border:1px solid var(--border,#e5e7eb);background:var(--card-bg,#fff);color:var(--text,#111);border-radius:8px;cursor:pointer;">Load more</button>
  </div>
  <script src="/js/infinite.js" defer></script>
{{ end }}

